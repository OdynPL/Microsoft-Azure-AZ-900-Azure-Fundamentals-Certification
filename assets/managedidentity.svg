<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="560">
  <style>
    .box { fill:#eef4ff; stroke:#4a84f4; stroke-width:2; rx:10; }
    .sub { fill:#ffffff; stroke:#7aa3f0; stroke-width:1.6; rx:8; }
    .title { font-family: Arial; font-size: 22px; font-weight: bold; }
    text { font-family: Arial; font-size: 14px; }
  </style>

  <text x="550" y="40" text-anchor="middle" class="title">
    Managed Identity - How it works
  </text>

  <rect x="50" y="70" width="1000" height="460" class="box"/>
  <text x="550" y="105" text-anchor="middle" style="font-size:16px;font-weight:bold;">
    App → Local MSI endpoint → Entra ID → Access Token → Call Azure resource
  </text>

  <!-- APPLICATION -->
  <rect x="80" y="160" width="300" height="150" class="sub"/>
  <text x="230" y="190" text-anchor="middle" style="font-weight:bold;">Application (in Azure)</text>
  <text x="230" y="215" text-anchor="middle">Has Managed Identity</text>
  <text x="230" y="235" text-anchor="middle">No secrets or certificates</text>

  <text x="400" y="235" text-anchor="middle" style="font-size:28px;">→</text>

  <!-- LOCAL MSI ENDPOINT -->
  <rect x="430" y="150" width="280" height="170" class="sub"/>
  <text x="570" y="180" text-anchor="middle" style="font-weight:bold;">Local MSI endpoint</text>
  <text x="570" y="205" text-anchor="middle">Available inside service</text>
  <text x="570" y="225" text-anchor="middle">Valid only from host</text>
  <text x="570" y="245" text-anchor="middle">Requests token for resource</text>

  <text x="720" y="235" text-anchor="middle" style="font-size:28px;">→</text>

  <!-- ENTRA ID -->
  <rect x="750" y="150" width="260" height="170" class="sub"/>
  <text x="880" y="180" text-anchor="middle" style="font-weight:bold;">Microsoft Entra ID</text>
  <text x="880" y="205" text-anchor="middle">Validates MI</text>
  <text x="880" y="225" text-anchor="middle">Checks RBAC scope</text>
  <text x="880" y="245" text-anchor="middle">Issues Access Token</text>

  <!-- TOKENS BOX -->
  <rect x="120" y="350" width="420" height="140" class="sub"/>
  <text x="330" y="380" text-anchor="middle" style="font-weight:bold;">Access Token</text>
  <text x="330" y="405" text-anchor="middle">Short lived (typically ~1h)</text>
  <text x="330" y="425" text-anchor="middle">Auto refresh via MSI endpoint</text>

  <text x="560" y="420" text-anchor="middle" style="font-size:28px;">→</text>

  <!-- TARGET RESOURCE -->
  <rect x="600" y="350" width="380" height="140" class="sub"/>
  <text x="790" y="380" text-anchor="middle" style="font-weight:bold;">Azure Resource</text>
  <text x="790" y="405" text-anchor="middle">Key Vault / Storage / SQL / Graph</text>
  <text x="790" y="425" text-anchor="middle">Validates token and RBAC</text>
  <text x="790" y="445" text-anchor="middle">Grants or denies access</text>
</svg>